{"ast":null,"code":"import{getVersionUpgrade,minVersionBump,VersionUpgrade}from'@uniswap/token-lists';import{useEffect}from'react';import{useDispatch,useSelector}from'react-redux';import{DEFAULT_TOKEN_LIST_URL}from'../../constants';import{addPopup}from'../application/actions';import{acceptListUpdate,addList,fetchTokenList}from'./actions';export default function Updater(){const dispatch=useDispatch();const lists=useSelector(state=>state.lists.byUrl);// we should always fetch the default token list, so add it\nuseEffect(()=>{if(!lists[DEFAULT_TOKEN_LIST_URL])dispatch(addList(DEFAULT_TOKEN_LIST_URL));},[dispatch,lists]);// on initial mount, refetch all the lists in storage\nuseEffect(()=>{Object.keys(lists).forEach(listUrl=>dispatch(fetchTokenList(listUrl)));// we only do this once\n// eslint-disable-next-line react-hooks/exhaustive-deps\n},[dispatch]);// whenever a list is not loaded and not loading, try again to load it\nuseEffect(()=>{Object.keys(lists).forEach(listUrl=>{const list=lists[listUrl];if(!list.current&&!list.loadingRequestId&&!list.error){dispatch(fetchTokenList(listUrl));}});},[dispatch,lists]);// automatically update lists if versions are minor/patch\nuseEffect(()=>{Object.keys(lists).forEach(listUrl=>{const list=lists[listUrl];if(list.current&&list.pendingUpdate){const bump=getVersionUpgrade(list.current.version,list.pendingUpdate.version);switch(bump){case VersionUpgrade.NONE:throw new Error('unexpected no version bump');case VersionUpgrade.PATCH:case VersionUpgrade.MINOR:case VersionUpgrade.MAJOR:const min=minVersionBump(list.current.tokens,list.pendingUpdate.tokens);// automatically update minor/patch as long as bump matches the min update\nif(bump>=min){dispatch(acceptListUpdate(listUrl));dispatch(addPopup({key:listUrl,content:{listUpdate:{listUrl,oldList:list.current,newList:list.pendingUpdate,auto:true}}}));}else{console.error(\"List at url \".concat(listUrl,\" could not automatically update because the version bump was only PATCH/MINOR while the update had breaking changes and should have been MAJOR\"));}break;// this will be turned on later\n// case VersionUpgrade.MAJOR:\n// dispatch(\n//   addPopup({\n//     key: listUrl,\n//     content: {\n//       listUpdate: {\n//         listUrl,\n//         auto: false,\n//         oldList: list.current,\n//         newList: list.pendingUpdate\n//       }\n//     }\n//   })\n// )\n}}});},[dispatch,lists]);return null;}","map":{"version":3,"names":["getVersionUpgrade","minVersionBump","VersionUpgrade","useEffect","useDispatch","useSelector","DEFAULT_TOKEN_LIST_URL","addPopup","acceptListUpdate","addList","fetchTokenList","Updater","dispatch","lists","state","byUrl","Object","keys","forEach","listUrl","list","current","loadingRequestId","error","pendingUpdate","bump","version","NONE","Error","PATCH","MINOR","MAJOR","min","tokens","key","content","listUpdate","oldList","newList","auto","console","concat"],"sources":["/Users/synallage/Desktop/fomoswap-uni/interface-73580de922ce3ff642430d71aa24f5c053e6dd4d/src/state/lists/updater.ts"],"sourcesContent":["import { getVersionUpgrade, minVersionBump, VersionUpgrade } from '@uniswap/token-lists'\nimport { useEffect } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { DEFAULT_TOKEN_LIST_URL } from '../../constants'\nimport { addPopup } from '../application/actions'\nimport { AppDispatch, AppState } from '../index'\nimport { acceptListUpdate, addList, fetchTokenList } from './actions'\n\nexport default function Updater(): null {\n  const dispatch = useDispatch<AppDispatch>()\n  const lists = useSelector<AppState, AppState['lists']['byUrl']>(state => state.lists.byUrl)\n\n  // we should always fetch the default token list, so add it\n  useEffect(() => {\n    if (!lists[DEFAULT_TOKEN_LIST_URL]) dispatch(addList(DEFAULT_TOKEN_LIST_URL))\n  }, [dispatch, lists])\n\n  // on initial mount, refetch all the lists in storage\n  useEffect(() => {\n    Object.keys(lists).forEach(listUrl => dispatch(fetchTokenList(listUrl) as any))\n    // we only do this once\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dispatch])\n\n  // whenever a list is not loaded and not loading, try again to load it\n  useEffect(() => {\n    Object.keys(lists).forEach(listUrl => {\n      const list = lists[listUrl]\n      if (!list.current && !list.loadingRequestId && !list.error) {\n        dispatch(fetchTokenList(listUrl) as any)\n      }\n    })\n  }, [dispatch, lists])\n\n  // automatically update lists if versions are minor/patch\n  useEffect(() => {\n    Object.keys(lists).forEach(listUrl => {\n      const list = lists[listUrl]\n      if (list.current && list.pendingUpdate) {\n        const bump = getVersionUpgrade(list.current.version, list.pendingUpdate.version)\n        switch (bump) {\n          case VersionUpgrade.NONE:\n            throw new Error('unexpected no version bump')\n          case VersionUpgrade.PATCH:\n          case VersionUpgrade.MINOR:\n          case VersionUpgrade.MAJOR:\n            const min = minVersionBump(list.current.tokens, list.pendingUpdate.tokens)\n            // automatically update minor/patch as long as bump matches the min update\n            if (bump >= min) {\n              dispatch(acceptListUpdate(listUrl))\n              dispatch(\n                addPopup({\n                  key: listUrl,\n                  content: {\n                    listUpdate: {\n                      listUrl,\n                      oldList: list.current,\n                      newList: list.pendingUpdate,\n                      auto: true\n                    }\n                  }\n                })\n              )\n            } else {\n              console.error(\n                `List at url ${listUrl} could not automatically update because the version bump was only PATCH/MINOR while the update had breaking changes and should have been MAJOR`\n              )\n            }\n            break\n\n          // this will be turned on later\n          // case VersionUpgrade.MAJOR:\n          // dispatch(\n          //   addPopup({\n          //     key: listUrl,\n          //     content: {\n          //       listUpdate: {\n          //         listUrl,\n          //         auto: false,\n          //         oldList: list.current,\n          //         newList: list.pendingUpdate\n          //       }\n          //     }\n          //   })\n          // )\n        }\n      }\n    })\n  }, [dispatch, lists])\n\n  return null\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}