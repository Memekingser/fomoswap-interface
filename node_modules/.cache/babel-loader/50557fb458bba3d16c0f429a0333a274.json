{"ast":null,"code":"import{useCallback,useEffect,useState}from'react';import{useActiveWeb3React}from'../../hooks';import useDebounce from'../../hooks/useDebounce';import useIsWindowVisible from'../../hooks/useIsWindowVisible';import{updateBlockNumber}from'./actions';import{useDispatch}from'react-redux';export default function Updater(){const{library,chainId}=useActiveWeb3React();const dispatch=useDispatch();const windowVisible=useIsWindowVisible();const[state,setState]=useState({chainId,blockNumber:null});const blockNumberCallback=useCallback(blockNumber=>{setState(state=>{if(chainId===state.chainId){if(typeof state.blockNumber!=='number')return{chainId,blockNumber};return{chainId,blockNumber:Math.max(blockNumber,state.blockNumber)};}return state;});},[chainId,setState]);// attach/detach listeners\nuseEffect(()=>{if(!library||!chainId||!windowVisible)return;setState({chainId,blockNumber:null});library.getBlockNumber().then(blockNumberCallback).catch(error=>console.error(\"Failed to get block number for chainId: \".concat(chainId),error));library.on('block',blockNumberCallback);return()=>{library.removeListener('block',blockNumberCallback);};},[dispatch,chainId,library,blockNumberCallback,windowVisible]);const debouncedState=useDebounce(state,100);useEffect(()=>{if(!debouncedState.chainId||!debouncedState.blockNumber||!windowVisible)return;dispatch(updateBlockNumber({chainId:debouncedState.chainId,blockNumber:debouncedState.blockNumber}));},[windowVisible,dispatch,debouncedState.blockNumber,debouncedState.chainId]);return null;}","map":{"version":3,"names":["useCallback","useEffect","useState","useActiveWeb3React","useDebounce","useIsWindowVisible","updateBlockNumber","useDispatch","Updater","library","chainId","dispatch","windowVisible","state","setState","blockNumber","blockNumberCallback","Math","max","getBlockNumber","then","catch","error","console","concat","on","removeListener","debouncedState"],"sources":["/Users/synallage/Desktop/fomoswap-uni/interface-73580de922ce3ff642430d71aa24f5c053e6dd4d/src/state/application/updater.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react'\nimport { useActiveWeb3React } from '../../hooks'\nimport useDebounce from '../../hooks/useDebounce'\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible'\nimport { updateBlockNumber } from './actions'\nimport { useDispatch } from 'react-redux'\n\nexport default function Updater() {\n  const { library, chainId } = useActiveWeb3React()\n  const dispatch = useDispatch()\n\n  const windowVisible = useIsWindowVisible()\n\n  const [state, setState] = useState<{ chainId: number | undefined; blockNumber: number | null }>({\n    chainId,\n    blockNumber: null\n  })\n\n  const blockNumberCallback = useCallback(\n    (blockNumber: number) => {\n      setState(state => {\n        if (chainId === state.chainId) {\n          if (typeof state.blockNumber !== 'number') return { chainId, blockNumber }\n          return { chainId, blockNumber: Math.max(blockNumber, state.blockNumber) }\n        }\n        return state\n      })\n    },\n    [chainId, setState]\n  )\n\n  // attach/detach listeners\n  useEffect(() => {\n    if (!library || !chainId || !windowVisible) return\n\n    setState({ chainId, blockNumber: null })\n\n    library\n      .getBlockNumber()\n      .then(blockNumberCallback)\n      .catch(error => console.error(`Failed to get block number for chainId: ${chainId}`, error))\n\n    library.on('block', blockNumberCallback)\n    return () => {\n      library.removeListener('block', blockNumberCallback)\n    }\n  }, [dispatch, chainId, library, blockNumberCallback, windowVisible])\n\n  const debouncedState = useDebounce(state, 100)\n\n  useEffect(() => {\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return\n    dispatch(updateBlockNumber({ chainId: debouncedState.chainId, blockNumber: debouncedState.blockNumber }))\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId])\n\n  return null\n}\n"],"mappings":"AAAA,OAASA,WAAW,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CACxD,OAASC,kBAAkB,KAAQ,aAAa,CAChD,MAAO,CAAAC,WAAW,KAAM,yBAAyB,CACjD,MAAO,CAAAC,kBAAkB,KAAM,gCAAgC,CAC/D,OAASC,iBAAiB,KAAQ,WAAW,CAC7C,OAASC,WAAW,KAAQ,aAAa,CAEzC,cAAe,SAAS,CAAAC,OAAOA,CAAA,CAAG,CAChC,KAAM,CAAEC,OAAO,CAAEC,OAAQ,CAAC,CAAGP,kBAAkB,CAAC,CAAC,CACjD,KAAM,CAAAQ,QAAQ,CAAGJ,WAAW,CAAC,CAAC,CAE9B,KAAM,CAAAK,aAAa,CAAGP,kBAAkB,CAAC,CAAC,CAE1C,KAAM,CAACQ,KAAK,CAAEC,QAAQ,CAAC,CAAGZ,QAAQ,CAA8D,CAC9FQ,OAAO,CACPK,WAAW,CAAE,IACf,CAAC,CAAC,CAEF,KAAM,CAAAC,mBAAmB,CAAGhB,WAAW,CACpCe,WAAmB,EAAK,CACvBD,QAAQ,CAACD,KAAK,EAAI,CAChB,GAAIH,OAAO,GAAKG,KAAK,CAACH,OAAO,CAAE,CAC7B,GAAI,MAAO,CAAAG,KAAK,CAACE,WAAW,GAAK,QAAQ,CAAE,MAAO,CAAEL,OAAO,CAAEK,WAAY,CAAC,CAC1E,MAAO,CAAEL,OAAO,CAAEK,WAAW,CAAEE,IAAI,CAACC,GAAG,CAACH,WAAW,CAAEF,KAAK,CAACE,WAAW,CAAE,CAAC,CAC3E,CACA,MAAO,CAAAF,KAAK,CACd,CAAC,CAAC,CACJ,CAAC,CACD,CAACH,OAAO,CAAEI,QAAQ,CACpB,CAAC,CAED;AACAb,SAAS,CAAC,IAAM,CACd,GAAI,CAACQ,OAAO,EAAI,CAACC,OAAO,EAAI,CAACE,aAAa,CAAE,OAE5CE,QAAQ,CAAC,CAAEJ,OAAO,CAAEK,WAAW,CAAE,IAAK,CAAC,CAAC,CAExCN,OAAO,CACJU,cAAc,CAAC,CAAC,CAChBC,IAAI,CAACJ,mBAAmB,CAAC,CACzBK,KAAK,CAACC,KAAK,EAAIC,OAAO,CAACD,KAAK,4CAAAE,MAAA,CAA4Cd,OAAO,EAAIY,KAAK,CAAC,CAAC,CAE7Fb,OAAO,CAACgB,EAAE,CAAC,OAAO,CAAET,mBAAmB,CAAC,CACxC,MAAO,IAAM,CACXP,OAAO,CAACiB,cAAc,CAAC,OAAO,CAAEV,mBAAmB,CAAC,CACtD,CAAC,CACH,CAAC,CAAE,CAACL,QAAQ,CAAED,OAAO,CAAED,OAAO,CAAEO,mBAAmB,CAAEJ,aAAa,CAAC,CAAC,CAEpE,KAAM,CAAAe,cAAc,CAAGvB,WAAW,CAACS,KAAK,CAAE,GAAG,CAAC,CAE9CZ,SAAS,CAAC,IAAM,CACd,GAAI,CAAC0B,cAAc,CAACjB,OAAO,EAAI,CAACiB,cAAc,CAACZ,WAAW,EAAI,CAACH,aAAa,CAAE,OAC9ED,QAAQ,CAACL,iBAAiB,CAAC,CAAEI,OAAO,CAAEiB,cAAc,CAACjB,OAAO,CAAEK,WAAW,CAAEY,cAAc,CAACZ,WAAY,CAAC,CAAC,CAAC,CAC3G,CAAC,CAAE,CAACH,aAAa,CAAED,QAAQ,CAAEgB,cAAc,CAACZ,WAAW,CAAEY,cAAc,CAACjB,OAAO,CAAC,CAAC,CAEjF,MAAO,KAAI,CACb","ignoreList":[]},"metadata":{},"sourceType":"module"}